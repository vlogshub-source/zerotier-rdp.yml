- name: Install ZeroTier
        run: |
          $ztUrl = "https://download.zerotier.com/dist/ZeroTier%20One.msi"
          $installerPath = "$env:TEMP\zerotier.msi"
          $logPath = "$env:TEMP\zt_install.log" # Log file for debugging
          
          # 1. Download the installer
          Invoke-WebRequest -Uri $ztUrl -OutFile $installerPath
          
          # 2. Run the installer and wait for a definite exit code
          $installResult = Start-Process msiexec.exe -ArgumentList "/i", "`"$installerPath`"", "/quiet", "/norestart", "/l*v", "`"$logPath`"" -PassThru -Wait
          
          # Check the installation result
          if ($installResult.ExitCode -ne 0) {
              Write-Error "ZeroTier installation failed with exit code $($installResult.ExitCode)."
              Write-Host "Printing Install Log for diagnosis:"
              Get-Content $logPath
              exit 1
          }
          Write-Host "ZeroTier installed successfully."
          Remove-Item $installerPath -Force
